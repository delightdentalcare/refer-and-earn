cat > admin.html <<'HTML'
<!doctype html>
<html lang="en"><head>
  <meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Admin — Refer & Earn</title>
  <link rel="stylesheet" href="css/style.css"/>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
</head><body>
<main class="container">
  <header class="card"><h2>Admin Panel</h2></header>

  <section class="card">
    <h3>Quick Login</h3>
    <input id="a_user" placeholder="username">
    <input id="a_pass" type="password" placeholder="password">
    <button id="a_login" class="btn">Login</button>
    <p class="muted">Username: <strong>batir</strong> Password: <strong>mubsbatir</strong></p>
  </section>

  <section id="adminArea" style="display:none">
    <div class="card">
      <h3>Stats</h3>
      <p>Total users: <strong id="totalUsers">0</strong></p>
      <p>Pending withdrawals: <strong id="pendingWithdrawals">0</strong></p>
      <p>Total balances: ₦<strong id="totalBalances">0</strong></p>
    </div>

    <div class="card">
      <h3>Users</h3>
      <div id="usersList">Loading...</div>
    </div>

    <div class="card">
      <h3>Withdrawals (pending)</h3>
      <div id="withdrawList">Loading...</div>
    </div>

    <div class="card">
      <h3>Posts</h3>
      <div id="postsList">Loading...</div>
    </div>
  </section>
</main>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBMV7NUVLf-9aEer5jlhqOv5u_Z7XM5oVo",
  authDomain: "refer-and-earn-74706.firebaseapp.com",
  databaseURL: "https://refer-and-earn-74706-default-rtdb.firebaseio.com",
  projectId: "refer-and-earn-74706",
  storageBucket: "refer-and-earn-74706.firebasestorage.app",
  messagingSenderId: "681290792261",
  appId: "1:681290792261:web:982ae0c9f81b7291bc922c"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const ADMIN_USER = 'batir', ADMIN_PASS='mubsbatir';
document.getElementById('a_login').addEventListener('click', ()=> {
  const u = document.getElementById('a_user').value.trim(), p = document.getElementById('a_pass').value.trim();
  if(u===ADMIN_USER && p===ADMIN_PASS){ document.getElementById('adminArea').style.display='block'; document.querySelector('.card').style.display='none'; init(); } else alert('Invalid admin credentials');
});

async function init(){
  loadStats(); loadUsers(); loadWithdrawals(); loadPosts();
  db.ref('users').on('value', loadStats);
}

async function loadStats(){
  const users = await db.ref('users').once('value'); document.getElementById('totalUsers').innerText = users.exists()? users.numChildren():0;
  let total=0; if(users.exists()){ users.forEach(u=> total += Number(u.val().balance || 0)); } document.getElementById('totalBalances').innerText = total;
  const wd = await db.ref('withdrawals').orderByChild('status').equalTo('pending').once('value'); document.getElementById('pendingWithdrawals').innerText = wd.exists()? wd.numChildren():0;
}

function loadUsers(){
  db.ref('users').on('value', snap=>{
    const c = document.getElementById('usersList'); c.innerHTML='';
    if(!snap.exists()){ c.innerHTML = '<p>No users</p>'; return; }
    snap.forEach(u=>{
      const v = u.val(); const k = u.key;
      const d = document.createElement('div'); d.className='item';
      d.innerHTML = `<p><strong>${v.name||v.email}</strong> — ₦${v.balance||0} — Level:${v.level||1} — Approved:${v.approved? 'YES':'NO'}</p>`;
      const t=document.createElement('button'); t.innerText = v.approved? 'Disable':'Enable'; t.className='btn'; t.onclick=()=> toggleUser(k, !v.approved);
      const lvl=document.createElement('button'); lvl.innerText='Set Level'; lvl.className='btn btn-ghost'; lvl.onclick=()=> setLevel(k);
      const credit=document.createElement('button'); credit.innerText='Add Balance'; credit.className='btn'; credit.onclick=()=> addBalance(k);
      d.appendChild(t); d.appendChild(lvl); d.appendChild(credit);
      c.appendChild(d);
    });
  });
}

async function toggleUser(k,to){ if(!confirm('Set approved=' + to + '?')) return; await db.ref('users/'+k+'/approved').set(!!to); alert('Updated'); }
async function setLevel(k){ const l=prompt('Enter level (1-3):','2'); if(!l) return; await db.ref('users/'+k+'/level').set(Number(l)); alert('Level set'); }
async function addBalance(k){ const a=prompt('Amount to add (NGN):','500'); if(!a) return; const snap = await db.ref('users/'+k).once('value'); const cur = snap.exists()? (snap.val().balance||0):0; await db.ref('users/'+k+'/balance').set(cur + Number(a)); alert('Balance added'); }

function loadWithdrawals(){
  db.ref('withdrawals').orderByChild('status').equalTo('pending').on('value', snap=>{
    const c = document.getElementById('withdrawList'); c.innerHTML='';
    if(!snap.exists()){ c.innerHTML='<p>No pending withdrawals</p>'; return; }
    snap.forEach(w=>{
      const v=w.val(); const k=w.key;
      const d = document.createElement('div'); d.className='item';
      d.innerHTML = `<p>${v.uid} — ₦${v.amount} — ${v.account}</p>`;
      const apro=document.createElement('button'); apro.innerText='Approve'; apro.className='btn'; apro.onclick=()=> approveWithdraw(k,v);
      d.appendChild(apro); c.appendChild(d);
    });
  });
}

async function approveWithdraw(k,v){
  if(!confirm('Approve and deduct balance?')) return;
  await db.ref('withdrawals/'+k+'/status').set('approved');
  const snap = await db.ref('users/'+v.uid).once('value'); const cur = snap.exists()? (snap.val().balance||0):0;
  await db.ref('users/'+v.uid+'/balance').set(Math.max(0, cur - Number(v.amount)));
  await db.ref('notifications/'+v.uid).push({ message:'Your withdrawal approved by admin', at: Date.now() });
  alert('Withdrawal approved (marked). Please process payout outside.');
}

function loadPosts(){
  db.ref('posts').on('value', snap=>{
    const c = document.getElementById('postsList'); c.innerHTML='';
    if(!snap.exists()){ c.innerHTML='<p>No posts</p>'; return; }
    snap.forEach(p=>{
      const v=p.val(); const k=p.key;
      const d=document.createElement('div'); d.className='item';
      d.innerHTML = `<h4>${v.title||'(no title)'} – by ${v.authorName}</h4><p>${v.text||''}</p><p>Likes:${v.likes||0} • Shares:${v.shares||0}</p>`;
      c.appendChild(d);
    });
  });
}
</script>
</body></html>
HTML
