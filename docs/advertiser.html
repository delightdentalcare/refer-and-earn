cat > advertiser.html <<'HTML'
<!doctype html>
<html lang="en"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Advertiser — Refer & Earn</title>
<link rel="stylesheet" href="css/style.css"/>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
<script src="https://js.paystack.co/v1/inline.js"></script>
</head><body>
<main class="container">
  <header class="card"><h2>Advertiser Panel</h2></header>

  <section class="card">
    <h3>Create Ad</h3>
    <input id="adv_company" placeholder="Company name">
    <input id="adv_email" placeholder="Contact email">
    <input id="adv_amount" type="number" placeholder="Amount (NGN)">
    <input id="adv_title" placeholder="Ad title">
    <textarea id="adv_body" placeholder="Ad body"></textarea>
    <input id="adv_link" placeholder="Destination URL (optional)">
    <input id="adv_image" type="file" accept="image/*">
    <progress id="adv_upload" value="0" max="100" style="width:100%;display:none"></progress>
    <button id="adv_submit" class="btn">Pay & Submit Ad</button>
  </section>

  <section class="card">
    <h3>Your Ads (pending & live)</h3>
    <div id="myAds">Loading...</div>
  </section>
</main>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBMV7NUVLf-9aEer5jlhqOv5u_Z7XM5oVo",
  authDomain: "refer-and-earn-74706.firebaseapp.com",
  databaseURL: "https://refer-and-earn-74706-default-rtdb.firebaseio.com",
  projectId: "refer-and-earn-74706",
  storageBucket: "refer-and-earn-74706.firebasestorage.app",
  messagingSenderId: "681290792261",
  appId: "1:681290792261:web:982ae0c9f81b7291bc922c"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const storage = firebase.storage();
const PAYSTACK_KEY = 'pk_live_aa0529d581117f84592d7deeaaee3ebac7628a3c';

const companyEl = document.getElementById('adv_company');
const emailEl = document.getElementById('adv_email');
const amountEl = document.getElementById('adv_amount');
const titleEl = document.getElementById('adv_title');
const bodyEl = document.getElementById('adv_body');
const linkEl = document.getElementById('adv_link');
const imageEl = document.getElementById('adv_image');
const progressEl = document.getElementById('adv_upload');

async function uploadImage(file){
  if(!file) return '';
  const path = 'ads/' + Date.now() + '_' + file.name.replace(/\s+/g,'_');
  const r = storage.ref(path);
  const task = r.put(file);
  return new Promise((resolve,reject)=>{
    progressEl.style.display='block';
    task.on('state_changed', snap=> { progressEl.value = (snap.bytesTransferred/snap.totalBytes)*100; }, err=>{ progressEl.style.display='none'; reject(err); }, async ()=>{ progressEl.style.display='none'; const url = await r.getDownloadURL(); resolve(url); });
  });
}

document.getElementById('adv_submit').addEventListener('click', async ()=>{
  const company = companyEl.value.trim(), email = emailEl.value.trim().toLowerCase(), amount = Number(amountEl.value), title = titleEl.value.trim(), body = bodyEl.value.trim(), link = linkEl.value.trim();
  const file = imageEl.files[0] || null;
  if(!company||!email||!amount||!title||!body) return alert('Fill required fields');
  const pendingRef = db.ref('adsPending').push();
  const key = pendingRef.key;
  let imageUrl = '';
  try{ imageUrl = await uploadImage(file); } catch(e){ return alert('Image upload failed: '+e.message); }
  await pendingRef.set({ company, email, amount, title, body, link, imageUrl, status:'pending', createdAt: Date.now() });

  // Paystack payment
  const handler = PaystackPop.setup({
    key: PAYSTACK_KEY,
    email,
    amount: amount * 100,
    currency: 'NGN',
    ref: 'ad_' + key + '_' + Date.now(),
    onClose: function(){ alert('Payment closed'); },
    callback: async function(response){
      await db.ref('adsPending/'+key+'/status').set('paid');
      await db.ref('adsPending/'+key+'/payRef').set(response.reference);
      await db.ref('notifications/admin').push({ type:'adPaid', key, company, amount, createdAt: Date.now() });
      alert('Payment successful — admin will review your ad.');
      location.href='advertiser.html';
    }
  });
  handler.openIframe();
});

// show my ads (all pending/live entries)
function loadMyAds(){
  db.ref('adsPending').on('value', snap=>{
    const c = document.getElementById('myAds'); c.innerHTML='';
    if(!snap.exists()){ c.innerHTML='<p>No ads</p>'; return; }
    snap.forEach(a=>{
      const v = a.val(); const d=document.createElement('div'); d.className='item';
      d.innerHTML = `<h4>${v.title} — ₦${v.amount} — ${v.status}</h4>`;
      c.appendChild(d);
    });
  });
}
loadMyAds();
</script>
</body></html>
HTML
